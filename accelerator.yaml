accelerator:
  displayName: Start Spring Accelerator
  description: Experimental Accelerator the replicates The Spring Initializer functionality (for approved application architectures)
  iconUrl: https://raw.githubusercontent.com/simple-starters/icons/master/icon-tanzu-light.png
  tags:
    - Tanzu
    - Accelerator
    - Java
    - SpringBoot
    - BackingServices
  imports:
    - name: java-version
    - name: springboot-version
    - name: springframework-version
    - name: database-selection
    - name: messaging-selection
  options:

engine:
#variable compute
    let:
    - name: "newPackageName"
      expression: "'com.morganstanley.'+#projectName.replaceAll('-','')"

#transformation
    merge:
    - include: ["**/*"]
      exclude: ["README.md","start-spring-accelerator-deployment.yaml",".git",".gradle",".idea","**/*.java","accelerator-dependency-deployment-1.2.1/**","accelerator-dependency-source-1.2.1/**"]

#rename HELP.md to README.md
#    - include: [ "HELP.md" ]
#      chain:
#        type: RewritePath
#        regex: 'HELP.md'
#        rewriteTo: "'README.md'"

#update deployment files config/workload.yaml
    - include: [ "config/workload.yaml" ]
      chain:
        - type: ReplaceText
          substitutions:
            - text: "spring-project-name"
              with: "#projectName"

#update project name in gradle settings
    - include: [ "settings.gradle" ]
      chain:
        - type: ReplaceText
          substitutions:
            - text: "project-name"
              with: "#projectName"

    - include: [ "build.gradle" ]
      chain:
        - type: InvokeFragment
          reference: java-version
        - type: InvokeFragment
          reference: springboot-version
        # include web client dependencies
        - type: InvokeFragment
          reference: springframework-version
        # address database selection
        - type: InvokeFragment
          reference: database-selection
        # address messaging selection
        - type: InvokeFragment
          reference: messaging-selection



#rename src project package name
    - include: ["**/*.java"]
      chain:
        - type: OpenRewriteRecipe
          recipe: org.openrewrite.java.ChangePackage
          options:
            oldPackageName: "'com.morganstanley.projectname'"
            newPackageName: "#newPackageName"






